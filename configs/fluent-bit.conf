[SERVICE]
    Flush         5
    Log_Level     info
    Daemon        off

[INPUT]
    Name              tail
    Path              /var/log/containers/*agent*.log
    Parser            docker
    Tag               agent.*
    Refresh_Interval  5

[INPUT]
    Name              tail
    Path              /var/log/containers/*redis*.log
    Parser            docker
    Tag               redis.*
    Refresh_Interval  5

[INPUT]
    Name              tail
    Path              /var/log/containers/*postgres*.log
    Parser            docker
    Tag               postgres.*
    Refresh_Interval  5

[INPUT]
    Name              systemd
    Tag               system
    Systemd_Filter    _SYSTEMD_UNIT=docker.service

[FILTER]
    Name              modify
    Match             *
    Add               hostname ${HOSTNAME}
    Add               environment production

[FILTER]
    Name              modify
    Match             agent.*
    Add               service agent
    Add               component ai-ml

[FILTER]
    Name              modify
    Match             redis.*
    Add               service cache
    Add               component database

[FILTER]
    Name              modify
    Match             postgres.*
    Add               service database
    Add               component database

[OUTPUT]
    Name  stdout
    Match *
    Format json_lines

[OUTPUT]
    Name  file
    Match *
    Path /var/log/fluent-bit/combined
    Format json_lines
    File  combined.log

[OUTPUT]
    Name  forward
    Match *
    Host fluent-bit-aggregator
    Port 24224
    Require_ack_response True

[OUTPUT]
    Name  http
    Match agent.*
    Host ${LOKI_URL}
    Port 3100
    URI /loki/api/v1/push
    Header Authorization Bearer ${LOKI_TOKEN}
    Format json_lines
    Json_date_key timestamp
    Json_date_format iso8601